
<!DOCTYPE html>
<html>
  <head>

    <title>Populartimes Manhattan</title>

    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">

    <style>
      #map {
          height: 100%;
          width: 50%;
        }
      html, body {
        height: 100vh;
        width: 100vw;
        margin: 0;
        padding: 0;
      }
    </style>

    <link href="https://fonts.googleapis.com/css?family=Anaheim" rel="stylesheet">
    <link rel="stylesheet" href="styles/page.css">
    <script src="https://use.fontawesome.com/c3ae742dde.js"></script>

  </head>

  <body class="body">

    <!-- Night Time Style of Map -->
    <script src="styles/map-styles-night.js"></script>

    <div id="clock"><span id="dayofweek">DAY</span> <span class="hour"></span>:00</div>
    <div id="map"></div>

    <div class="left">
      <div class="left-title">The Populartimes - Manhattan</div>
      <br>
      <div>Welcome to the the populartimes data visualization of Manhattan! <br><br>
        Each dot on the map represent an establishment in the Manhattan area. The size of each dot will change with respect to how busy the establishment is (relatively speaking). Hit the play button to animate the data below! You may also click on the dot to identify the establishment. <br><br>
        restaurants(red dots), bars (green dots), nightclubs (blue dots) <br><br>

        The populartimes data is pulled from Google's Places API.
      </div>
      <br>

      <div class="left-day">Day of the Week<div>
      <form id="day">
        <div class="day">
          <input type="radio" id="Monday" name="day" value="0" onclick="handleDay(this,event)" checked="checked"><label   for="monday">Monday</label>
        </div>
        <div class="day">
          <input type="radio" id="Tuesday" name="day" value="1" onclick="handleDay(this)">
          <label for="tuesday">Tuesday</label>
        </div>
        <div class="day">
          <input type="radio" id="Wednesday" name="day" value="2" onclick="handleDay(this)">
          <label for="wednesday">Wednesday</label>
        </div>
        <div class="day">
          <input type="radio" id="Thursday" name="day" value="3" onclick="handleDay(this)">
          <label for="Thursday">Thursday</label>
        </div>
        <div class="day">
          <input type="radio" id="Friday" name="day" value="4" onclick="handleDay(this)">
          <label for="friday">Friday</label>
        </div>
        <div class="day">
          <input type="radio" id="Saturday" name="day" value="5" onclick="handleDay(this)">
          <label for="saturday">Saturday</label>
        </div>
        <div class="day">
          <input type="radio" id="Sunday" name="day" value="6" onclick="handleDay(this)">
          <label for="sunday">Sunday</label>
        </div>
      </form>

      <br>
      <br>

      <div class="hourTitle">Hour (military time)</div>
      <div id="hourSliderContainer">
        <input type="range" min="0" max="23" value="0" class="slider" id="hourSlider">
      </div>
      Hour: <span class="hour">0</span>:00
      <button type="button" name="button" onclick="handlePlay()">play</button>
      <button type="button" name="button" onclick="handlePause()">pause</button>


      <br><br><br>
      <div>Restaurant Density</div>
      <div id="resturantDensitySliderContainer">
        <input type="range" min="0" max="100" value="20" class="slider" id="resturantDensitySlider">
        <br>
      </div>
      Restaurant Density: <span id="restDensity">20</span>%
      <br><br>
      Note: The default density is set to 20% as most devices should be able to handle the data input. Depending on your device, you may experience extrenuous lag.
      <br><br>

      <div class="footer">
        If you'd like my project, check out my what else I am working on by checking out my portfolio page and github!
        <div class="footer-logos">
          <a class="fa fa-user-o" aria-hidden="true" href="http://mattyliu.com"></a>
          <a class="fa fa-github" aria-hidden="true" href="https://github.com/matty-liu"></a>
          <a class="fa fa-linkedin-square" aria-hidden="true" href="https://www.linkedin.com/in/matthew-liuu/"></a>
          <a class="fa fa-envelope" aria-hidden="true" href="mailto:mattkliu@gmail.com"></a>
        </div>
      </div>

    </div>


    <!-- Resturant Data from Google Places -->
    <script src="data/places-manhat-data-restaurants.js"></script>
    <script src="data/places-manhat-data-restaurants2.js"></script>
    <script src="data/places-manhat-data-restaurants3.js"></script>
    <script src="data/places-manhat-data-restaurants4.js"></script>
    <script src="data/places-manhat-data-restaurants5.js"></script>
    <script src="data/places-manhat-data-restaurants6.js"></script>
    <!-- Bar+Nightclub Data from Google Places -->
    <script src="data/places-manhat-data-bars1.js"></script>
    <script src="data/places-manhat-data-nightclub1.js"></script>

    <!-- Data combined and bound to a variable named
    googleRestaurants for resturants and
    googlebars for bars -->
    <script src="data/places-manhat-data-join.js"></script>

    <!-- Map and data point generation -->
    <script>
    console.log(googleRestaurants)
    console.log(googleBars)
    console.log(googleNightclub)

    let map;
    let circles = [];
    let currentBounds;

    function initMap() {

      map = new google.maps.Map(document.getElementById('map'), {
        disableDefaultUI: true,
        center: {lat: 40.73318067925024, lng: -73.99484466674808},
        zoom: 13,
        styles: nightStyles,
        zoomControl: true,
      });

      google.maps.event.addListener(map, 'idle', () => {
        console.log("bounds have changed!")
        const {north,south,east,west} = map.getBounds().toJSON()
        currentBounds = {
          southWest: {lat:south, lng:west},
          northEast: {lat:north, lng:east},
        }
      })

      googleRestaurants.forEach((place) => {
        const circle = new google.maps.Circle({
          strokeColor: '#FF0000',
          strokeOpacity: 0.8,
          strokeWeight: 2,
          fillColor: '#FF0000',
          fillOpacity: 0.35,
          map: map,
          center: place.coordinates,
          radius: 1,
          populartimes: place.populartimes,
          position: place.coordinates,
        })

        let chance = 20;
        let randNum = Math.random()*100;
        if (randNum <= chance) {
        } else {
          circle.setMap(null)
        }

        const contentString =
        `<div class="infowindow">`+
          `<div>Name: ${place.name}<div>`+
          `<div>Address: ${place.address}<div>`+
          `<div>Phone Number: ${place.international_phone_number}<div>`+
          `<div>Rating: ${place.rating}<div>`+
          `<div>Number of Ratings: ${place.rating_n}<div>`+
        `</div>`;
        const infowindow = new google.maps.InfoWindow({
          content: contentString
        })

        circle.addListener('click', () => {
          infowindow.open(map,circle);
        })
        circles.push(circle)

        // const heatMapPoint = { location: new google.maps.LatLng(place.coordinates.lat, place.coordinates.lng), weight: 0 }
        // heatMapData.push(heatMapPoint)

      })

      googleBars.forEach((place) => {

        const circle = new google.maps.Circle({
          strokeColor: '#00FF00',
          strokeOpacity: 0.8,
          strokeWeight: 2,
          fillColor: '#00FF00',
          fillOpacity: 0.35,
          map: map,
          center: place.coordinates,
          radius: 1,
          populartimes: place.populartimes,
          position: place.coordinates,
        })

        let chance = 20;
        let randNum = Math.random()*100;

        if (randNum <= chance) {
        } else {
          circle.setMap(null)
        }

        const contentString =
        `<div class="infowindow">`+
          `<div>Name: ${place.name}<div>`+
          `<div>Address: ${place.address}<div>`+
          `<div>Phone Number: ${place.international_phone_number}<div>`+
          `<div>Rating: ${place.rating}<div>`+
          `<div>Number of Ratings: ${place.rating_n}<div>`+
        `</div>`;

        const infowindow = new google.maps.InfoWindow({
          content: contentString
        })

        circle.addListener('click', () => {
          infowindow.open(map,circle);
        })

        circles.push(circle)

      })

      googleNightclub.forEach((place) => {

        const circle = new google.maps.Circle({
          strokeColor: '#0000FF',
          strokeOpacity: 0.8,
          strokeWeight: 2,
          fillColor: '#0000FF',
          fillOpacity: 0.35,
          map: map,
          center: place.coordinates,
          radius: 1,
          populartimes: place.populartimes,
          position: place.coordinates,
        })

        let chance = 20;
        let randNum = Math.random()*100;

        if (randNum <= chance) {
        } else {
          circle.setMap(null)
        }

        const contentString =
        `<div class="infowindow">`+
          `<div>Name: ${place.name}<div>`+
          `<div>Address: ${place.address}<div>`+
          `<div>Phone Number: ${place.international_phone_number}<div>`+
          `<div>Rating: ${place.rating}<div>`+
          `<div>Number of Ratings: ${place.rating_n}<div>`+
        `</div>`;

        const infowindow = new google.maps.InfoWindow({
          content: contentString
        })

        circle.addListener('click', () => {
          infowindow.open(map,circle);
        })

        circles.push(circle)

      })

      //
      // let heatmap = new google.maps.visualization.HeatmapLayer({
      //   data: heatMapData,
      // });
      //
      // heatmap.setMap(map);

    }
    </script>

    <!-- data controls/filters -->
    <script src="update_controls.js"></script>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyASUnStAUyUBSLjckIAwrFwrg2e4mTnmGs&callback=initMap&libraries=visualization"async defer>
    </script>

  </body>
</html>
