
<!DOCTYPE html>
<html>
  <head>

    <title>Populartimes Manhattan</title>

    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <style>
      #map {
          height: 100vh;
          width: 55%;
        }
      html, body {
        height: auto;
        width: 100vw;
        margin: 0;
        padding: 0;
      }
    </style>

    <link href="https://fonts.googleapis.com/css?family=Anaheim" rel="stylesheet">
    <link rel="stylesheet" href="styles/page.css">
    <link rel="stylesheet" href="styles/controller.css">
    <link rel="stylesheet" href="styles/info-modal.css">
    <link rel="stylesheet" href="styles/resize.css">
    <script src="https://use.fontawesome.com/c3ae742dde.js"></script>

  </head>

  <body class="body">

    <!-- Night Time Style of Map -->
    <script src="styles/map-styles-night.js"></script>


    <div id="clock">
      <span id="dayofweek">Monday</span>
      <span class="hour"> 00</span>:00
    </div>

    <div id="map">
    </div>


    <div class="left">
      <div class="left-title">The Populartimes - Manhattan</div>


      <div class="description-container">

        <div class="description-text">
          <div class="description-greeting">
            Welcome to the the populartimes data visualization of Manhattan!
          </div>
          <div class="description-text-explanation">
            Each dot on the map represent an establishment in the Manhattan area. Click the button to find out more about the dots!
            <button id="infoModalButton">Info</button>
          </div>
        </div>

      </div>

      <strong>You may also click on the dot to identify the establishment.</strong>

      <div class="controller">

        <form id="day">
          <div>Day of the Week</div>
          <div class="day">
            <input type="radio" id="Sunday" name="day" value="6" onclick="handleDay(this)" checked="checked">
            <label for="sunday">Sunday</label>
          </div>
          <div class="day">
            <input type="radio" id="Monday" name="day" value="0" onclick="handleDay(this,event)"><label for="monday"> Monday</label>
          </div>
          <div class="day">
            <input type="radio" id="Tuesday" name="day" value="1" onclick="handleDay(this)">
            <label for="tuesday">Tuesday</label>
          </div>
          <div class="day">
            <input type="radio" id="Wednesday" name="day" value="2" onclick="handleDay(this)">
            <label for="wednesday">Wednesday</label>
          </div>
          <div class="day">
            <input type="radio" id="Thursday" name="day" value="3" onclick="handleDay(this)">
            <label for="Thursday">Thursday</label>
          </div>
          <div class="day">
            <input type="radio" id="Friday" name="day" value="4" onclick="handleDay(this)">
            <label for="friday">Friday</label>
          </div>
          <div class="day">
            <input type="radio" id="Saturday" name="day" value="5" onclick="handleDay(this)">
            <label for="saturday">Saturday</label>
          </div>
        </form>

        <div class="controller-sliders">
          <div class="hour-controls-container">
            <div class="">Hour (military time) : <span class="hour">00</span>:00</div>
            <div class="hour-controls-buttons">
              <button type="button" name="button" onclick="handlePlay()">play</button>
              <button type="button" name="button" onclick="handlePause()">pause</button>
            </div>
          </div>
          <div id="hourSliderContainer">
            <input type="range" min="0" max="23" value="0" class="slider" id="hourSlider">
          </div>

          <div>Establishment Density: <span id="restDensity">20</span>%</div>
          <div id="resturantDensitySliderContainer">
            <input type="range" min="0" max="100" value="20" class="slider" id="resturantDensitySlider">
          </div>
          Note: The default density is set to 20% to support most devices.
        </div>

        <div id="footer" class="footer">
          Establishment data is pulled from Google's Places API. <br><br>

          If you'd like my project, and want to find out more about this project or what else I am working on, check my Github!
          <div class="footer-logos">
            <a class="fa fa-user-o" aria-hidden="true" href="http://mattyliu.com"></a>
            <a class="fa fa-github" aria-hidden="true" href="https://github.com/matty-liu"></a>
            <a class="fa fa-linkedin-square" aria-hidden="true" href="https://www.linkedin.com/in/matthew-liuu/"></a>
            <a class="fa fa-envelope" aria-hidden="true" href="mailto:mattkliu@gmail.com"></a>
          </div>
        </div>

      </div>

    </div>

    <!-- The Modal -->
    <div id="infoModal" class="modal">

      <!-- Modal content -->
      <div class="modal-content">
        <span class="close">&times;</span>
        <div id="info" class="description-dots">
          The different colored dots represent the following establishment types:
          <div class="description-colors">
            <div class="red">
              restaurants<br>(red dots)
            </div>
            <div class="green">
              bars<br>(green dots)
            </div>
            <div class="blue">
              nightclubs<br>(blue dots)
            </div>
            <div>

            </div>
          </div>
          <div class="size">
            The size of each dot will change with respect to how busy the establishment is (relatively speaking) at the corresponding time that is indicated on the clock. The "business" of a establishment is based off of Google Places API (the graph that tell you how busy a restaurant is and using that data we generate our visual). It should be noted that this is relatively speaking, so the dots are not always reflective of the amount of people in the area.
          </div>
        </div>
      </div>

    </div>

    <script src="info-modal.js"></script>

    <!-- Resturant Data from Google Places -->
    <script src="data/places-manhat-data-restaurants.js"></script>
    <script src="data/places-manhat-data-restaurants2.js"></script>
    <script src="data/places-manhat-data-restaurants3.js"></script>
    <script src="data/places-manhat-data-restaurants4.js"></script>
    <script src="data/places-manhat-data-restaurants5.js"></script>
    <script src="data/places-manhat-data-restaurants6.js"></script>
    <!-- Bar+Nightclub Data from Google Places -->
    <script src="data/places-manhat-data-bars1.js"></script>
    <script src="data/places-manhat-data-nightclub1.js"></script>

    <!-- Data combined and bound to a variable named
    googleRestaurants for resturants and
    googlebars for bars -->
    <script src="data/places-manhat-data-join.js"></script>

    <!-- Map and data point generation -->
    <script>
    console.log(googleRestaurants)
    console.log(googleBars)
    console.log(googleNightclub)

    let map;
    let circles = [];
    let currentBounds;

    function initMap() {

      map = new google.maps.Map(document.getElementById('map'), {
        disableDefaultUI: true,
        center: {lat: 40.73318067925024, lng: -73.99484466674808},
        zoom: 13,
        styles: nightStyles,
        zoomControl: true,
      });

      google.maps.event.addListener(map, 'idle', () => {
        console.log("bounds have changed!")
        const {north,south,east,west} = map.getBounds().toJSON()
        currentBounds = {
          southWest: {lat:south, lng:west},
          northEast: {lat:north, lng:east},
        }
      })

      googleRestaurants.forEach((place) => {
        const circle = new google.maps.Circle({
          strokeColor: '#FF0000',
          strokeOpacity: 0.8,
          strokeWeight: 2,
          fillColor: '#FF0000',
          fillOpacity: 0.35,
          map: map,
          center: place.coordinates,
          radius: 1,
          radiusPrev: 1,
          populartimes: place.populartimes,
          position: place.coordinates,
        })

        let chance = 20;
        let randNum = Math.random()*100;
        if (randNum <= chance) {
        } else {
          circle.setMap(null)
        }

        const contentString =
        `<div class="infowindow">`+
          `<div>Name: ${place.name}<div>`+
          `<div>Address: ${place.address}<div>`+
          `<div>Phone Number: ${place.international_phone_number}<div>`+
          `<div>Rating: ${place.rating}<div>`+
          `<div>Number of Ratings: ${place.rating_n}<div>`+
        `</div>`;
        const infowindow = new google.maps.InfoWindow({
          content: contentString
        })

        circle.addListener('click', () => {
          infowindow.open(map,circle);
        })
        circles.push(circle)

        // const heatMapPoint = { location: new google.maps.LatLng(place.coordinates.lat, place.coordinates.lng), weight: 0 }
        // heatMapData.push(heatMapPoint)

      })

      googleBars.forEach((place) => {

        const circle = new google.maps.Circle({
          strokeColor: '#00FF00',
          strokeOpacity: 0.8,
          strokeWeight: 2,
          fillColor: '#00FF00',
          fillOpacity: 0.35,
          map: map,
          center: place.coordinates,
          radius: 1,
          populartimes: place.populartimes,
          position: place.coordinates,
        })

        let chance = 20;
        let randNum = Math.random()*100;

        if (randNum <= chance) {
        } else {
          circle.setMap(null)
        }

        const contentString =
        `<div class="infowindow">`+
          `<div>Name: ${place.name}<div>`+
          `<div>Address: ${place.address}<div>`+
          `<div>Phone Number: ${place.international_phone_number}<div>`+
          `<div>Rating: ${place.rating}<div>`+
          `<div>Number of Ratings: ${place.rating_n}<div>`+
        `</div>`;

        const infowindow = new google.maps.InfoWindow({
          content: contentString
        })

        circle.addListener('click', () => {
          infowindow.open(map,circle);
        })

        circles.push(circle)

      })

      googleNightclub.forEach((place) => {

        const circle = new google.maps.Circle({
          strokeColor: '#0000FF',
          strokeOpacity: 0.8,
          strokeWeight: 2,
          fillColor: '#0000FF',
          fillOpacity: 0.35,
          map: map,
          center: place.coordinates,
          radius: 1,
          populartimes: place.populartimes,
          position: place.coordinates,
        })

        let chance = 20;
        let randNum = Math.random()*100;

        if (randNum <= chance) {
        } else {
          circle.setMap(null)
        }

        const contentString =
        `<div class="infowindow">`+
          `<div>Name: ${place.name}<div>`+
          `<div>Address: ${place.address}<div>`+
          `<div>Phone Number: ${place.international_phone_number}<div>`+
          `<div>Rating: ${place.rating}<div>`+
          `<div>Number of Ratings: ${place.rating_n}<div>`+
        `</div>`;

        const infowindow = new google.maps.InfoWindow({
          content: contentString
        })

        circle.addListener('click', () => {
          infowindow.open(map,circle);
        })

        circles.push(circle)

      })

      //
      // let heatmap = new google.maps.visualization.HeatmapLayer({
      //   data: heatMapData,
      // });
      //
      // heatmap.setMap(map);

    }
    </script>

    <!-- data controls/filters -->
    <script src="update_controls.js"></script>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyASUnStAUyUBSLjckIAwrFwrg2e4mTnmGs&callback=initMap&libraries=visualization"async defer>
    </script>

  </body>
</html>
